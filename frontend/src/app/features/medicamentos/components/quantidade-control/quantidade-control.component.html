<div
  class="quantidade-control"
  [class.compact]="size === 'sm'"
  [class.loading]="loading"
  [class.success]="showSuccess()"
  [class.error]="showError()"
  role="group"
  [attr.aria-label]="'Controle de quantidade: ' + quantidade + ' unidades'"
>
  <!-- Botão Decrementar -->
  <app-button
    variant="outline"
    [size]="size"
    [disabled]="isDecrementDisabled"
    (clicked)="onDecrementar()"
    class="btn-minus"
    aria-label="Diminuir quantidade"
    [iconOnly]="true"
    icon="minus"
  >
    Diminuir
  </app-button>

  <!-- Display de Quantidade -->
  <div class="quantidade-display" [class.updating]="loading" [attr.aria-live]="loading ? 'polite' : 'off'">
    <!-- Valor atual -->
    <span class="quantidade-value" [class.animating]="isAnimating()">
      {{ displayQuantidade }}
    </span>

    <!-- Total (opcional) -->
    <span *ngIf="showTotal && quantidadeTotal" class="quantidade-total"> / {{ quantidadeTotal }} </span>

    <!-- Indicador de loading -->
    @if (loading) {
      <span class="loading-indicator" aria-hidden="true">
        <app-icon name="loader-2" [size]="14" class="animate-spin" />
      </span>
    }
  </div>

  <!-- Botão Incrementar -->
  <app-button
    variant="outline"
    [size]="size"
    [disabled]="isIncrementDisabled"
    (clicked)="onIncrementar()"
    class="btn-plus"
    aria-label="Aumentar quantidade"
    [iconOnly]="true"
    icon="plus"
  >
    Aumentar
  </app-button>
</div>

<!-- Mensagem de erro -->
@if (errorMessage()) {
  <div class="error-message" role="alert">
    <app-icon name="alert-circle" [size]="12" />
    {{ errorMessage() }}
  </div>
}
