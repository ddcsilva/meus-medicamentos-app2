<form [formGroup]="form" (ngSubmit)="onSubmit()" class="medicamento-form">
  <!-- Seção: Identificação -->
  <div class="form-section">
    <h3 class="section-title">Identificação</h3>

    <div class="form-row">
      <div class="form-field">
        <label for="nome" class="form-label"> Nome do Medicamento <span class="required">*</span> </label>
        <input
          id="nome"
          type="text"
          formControlName="nome"
          class="form-input"
          [class.has-error]="isFieldInvalid('nome')"
          placeholder="Ex: Dipirona 500mg"
        />
        <span *ngIf="isFieldInvalid('nome')" class="field-error">
          {{ getFieldError('nome') }}
        </span>
      </div>
    </div>

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="droga" class="form-label"> Princípio Ativo / Droga <span class="required">*</span> </label>
        <input
          id="droga"
          type="text"
          formControlName="droga"
          class="form-input"
          [class.has-error]="isFieldInvalid('droga')"
          placeholder="Ex: Dipirona Sódica"
        />
        <span *ngIf="isFieldInvalid('droga')" class="field-error">
          {{ getFieldError('droga') }}
        </span>
      </div>

      <div class="form-field">
        <label class="form-label">É Genérico?</label>
        <div class="checkbox-wrapper">
          <input id="generico" type="checkbox" formControlName="generico" class="form-checkbox" />
          <label for="generico" class="checkbox-label"> Sim, é medicamento genérico </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção: Fabricante -->
  <div class="form-section">
    <h3 class="section-title">Fabricante</h3>

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="marca" class="form-label"> Marca <span class="required">*</span> </label>
        <input
          id="marca"
          type="text"
          formControlName="marca"
          class="form-input"
          [class.has-error]="isFieldInvalid('marca')"
          placeholder="Ex: Medley"
        />
        <span *ngIf="isFieldInvalid('marca')" class="field-error">
          {{ getFieldError('marca') }}
        </span>
      </div>

      <div class="form-field">
        <label for="laboratorio" class="form-label"> Laboratório <span class="required">*</span> </label>
        <input
          id="laboratorio"
          type="text"
          formControlName="laboratorio"
          class="form-input"
          [class.has-error]="isFieldInvalid('laboratorio')"
          placeholder="Ex: Sanofi"
        />
        <span *ngIf="isFieldInvalid('laboratorio')" class="field-error">
          {{ getFieldError('laboratorio') }}
        </span>
      </div>
    </div>
  </div>

  <!-- Seção: Detalhes -->
  <div class="form-section">
    <h3 class="section-title">Detalhes</h3>

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="tipo" class="form-label"> Tipo <span class="required">*</span> </label>
        <select id="tipo" formControlName="tipo" class="form-select" [class.has-error]="isFieldInvalid('tipo')">
          <option value="">Selecione...</option>
          <option *ngFor="let tipo of tiposMedicamento" [value]="tipo">
            {{ formatarTipo(tipo) }}
          </option>
        </select>
        <span *ngIf="isFieldInvalid('tipo')" class="field-error">
          {{ getFieldError('tipo') }}
        </span>
      </div>

      <div class="form-field">
        <label for="validade" class="form-label"> Data de Validade <span class="required">*</span> </label>
        <input
          id="validade"
          type="date"
          formControlName="validade"
          class="form-input"
          [class.has-error]="isFieldInvalid('validade')"
        />
        <span *ngIf="isFieldInvalid('validade')" class="field-error">
          {{ getFieldError('validade') }}
        </span>
      </div>
    </div>
  </div>

  <!-- Seção: Quantidade -->
  <div class="form-section">
    <h3 class="section-title">Quantidade</h3>

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="quantidadeTotal" class="form-label"> Quantidade Total <span class="required">*</span> </label>
        <input
          id="quantidadeTotal"
          type="number"
          formControlName="quantidadeTotal"
          class="form-input"
          [class.has-error]="isFieldInvalid('quantidadeTotal')"
          min="1"
          placeholder="Ex: 20"
        />
        <span class="field-hint"> Quantidade total na embalagem/caixa </span>
        <span *ngIf="isFieldInvalid('quantidadeTotal')" class="field-error">
          {{ getFieldError('quantidadeTotal') }}
        </span>
      </div>

      <div class="form-field">
        <label for="quantidadeAtual" class="form-label"> Quantidade Atual <span class="required">*</span> </label>
        <input
          id="quantidadeAtual"
          type="number"
          formControlName="quantidadeAtual"
          class="form-input"
          [class.has-error]="isFieldInvalid('quantidadeAtual')"
          min="0"
          placeholder="Ex: 20"
        />
        <span class="field-hint"> Quantidade disponível no momento </span>
        <span *ngIf="isFieldInvalid('quantidadeAtual')" class="field-error">
          {{ getFieldError('quantidadeAtual') }}
        </span>
      </div>
    </div>
  </div>

  <!-- Seção: Observações -->
  <div class="form-section">
    <h3 class="section-title">Observações</h3>

    <div class="form-row">
      <div class="form-field">
        <label for="observacoes" class="form-label"> Observações (opcional) </label>
        <textarea
          id="observacoes"
          formControlName="observacoes"
          class="form-textarea"
          rows="3"
          placeholder="Ex: Tomar após as refeições, armazenar em local fresco..."
        ></textarea>
      </div>
    </div>
  </div>

  <!-- Ações -->
  <div class="form-actions">
    <app-button type="button" variant="outline" (click)="onCancelar()"> Cancelar </app-button>
    <app-button type="submit" variant="primary" [loading]="loading" [disabled]="form.invalid || loading">
      {{ loading ? 'Salvando...' : submitLabel }}
    </app-button>
  </div>
</form>
